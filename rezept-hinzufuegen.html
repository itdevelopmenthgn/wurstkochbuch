<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rezept hinzufÃ¼gen â€“ Die WÃ¼rstelmacher</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        .form-container {
            max-width: 860px;
            margin: 2rem auto;
            padding: 0 1rem;
        }

        .form-card {
            background: var(--card-bg);
            border: 2px solid var(--border-color);
            border-radius: 8px;
            padding: 2rem;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            margin-bottom: 1.5rem;
            position: relative;
        }

        .form-card::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0;
            height: 8px;
            background: linear-gradient(90deg, var(--primary-color), var(--accent-color));
            border-radius: 8px 8px 0 0;
        }

        .form-card h2 {
            color: var(--primary-color);
            font-size: 1.3rem;
            margin-bottom: 1.2rem;
            margin-top: 0.5rem;
            border-bottom: 2px solid var(--border-color);
            padding-bottom: 0.5rem;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .form-row.single {
            grid-template-columns: 1fr;
        }

        .form-row.triple {
            grid-template-columns: 2fr 1fr 1fr;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            font-weight: bold;
            color: var(--primary-color);
            margin-bottom: 0.3rem;
            font-size: 0.95rem;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            padding: 0.6rem 0.9rem;
            border: 2px solid var(--border-color);
            border-radius: 5px;
            background: var(--bg-color);
            color: var(--text-color);
            font-family: Georgia, serif;
            font-size: 1rem;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--primary-color);
        }

        .form-group textarea {
            resize: vertical;
            min-height: 80px;
        }

        /* Dynamische Tabellen (Fleischsorten, Zutaten, GewÃ¼rze) */
        .zutaten-tabelle {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 0.8rem;
        }

        .zutaten-tabelle thead th {
            background: var(--primary-color);
            color: #FFF8DC;
            padding: 0.5rem 0.7rem;
            font-size: 0.9rem;
            text-align: left;
            font-weight: bold;
        }

        .zutaten-tabelle tbody tr:nth-child(even) {
            background: rgba(139,69,19,0.05);
        }

        .zutaten-tabelle tbody td {
            padding: 0.3rem 0.4rem;
        }

        .zutaten-tabelle tbody td input,
        .zutaten-tabelle tbody td select {
            width: 100%;
            padding: 0.4rem 0.6rem;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            background: var(--card-bg);
            color: var(--text-color);
            font-family: Georgia, serif;
            font-size: 0.95rem;
        }

        .zutaten-tabelle .col-name { width: 55%; }
        .zutaten-tabelle .col-menge { width: 20%; }
        .zutaten-tabelle .col-einheit { width: 18%; }
        .zutaten-tabelle .col-del { width: 7%; text-align: center; }

        .btn-del-row {
            background: #c0392b;
            color: white;
            border: none;
            border-radius: 4px;
            padding: 0.3rem 0.6rem;
            cursor: pointer;
            font-size: 1rem;
            line-height: 1;
        }

        .btn-del-row:hover {
            background: #a93226;
        }

        .btn-add-row {
            background: rgba(139,69,19,0.12);
            color: var(--primary-color);
            border: 2px dashed var(--border-color);
            border-radius: 5px;
            padding: 0.45rem 1rem;
            cursor: pointer;
            font-family: Georgia, serif;
            font-size: 0.95rem;
            width: 100%;
            transition: background 0.2s;
        }

        .btn-add-row:hover {
            background: rgba(139,69,19,0.22);
        }

        /* Schritte */
        .schritt-gruppe {
            border: 2px solid var(--border-color);
            border-radius: 6px;
            padding: 1rem;
            margin-bottom: 1rem;
            background: rgba(139,69,19,0.03);
        }

        .schritt-gruppe-header {
            display: flex;
            align-items: center;
            gap: 0.7rem;
            margin-bottom: 0.8rem;
        }

        .schritt-gruppe-header input {
            flex: 1;
            padding: 0.5rem 0.8rem;
            border: 2px solid var(--border-color);
            border-radius: 5px;
            background: var(--bg-color);
            color: var(--text-color);
            font-family: Georgia, serif;
            font-size: 1rem;
            font-weight: bold;
        }

        .schritt-einzeln {
            display: grid;
            grid-template-columns: 1fr 2fr auto;
            gap: 0.5rem;
            align-items: start;
            margin-bottom: 0.5rem;
        }

        .schritt-einzeln input,
        .schritt-einzeln textarea {
            padding: 0.5rem 0.7rem;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            background: var(--card-bg);
            color: var(--text-color);
            font-family: Georgia, serif;
            font-size: 0.95rem;
        }

        .schritt-einzeln textarea {
            resize: vertical;
            min-height: 60px;
        }

        /* Tipps */
        .tipp-zeile {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 0.5rem;
        }

        .tipp-zeile input {
            flex: 1;
            padding: 0.5rem 0.8rem;
            border: 2px solid var(--border-color);
            border-radius: 5px;
            background: var(--bg-color);
            color: var(--text-color);
            font-family: Georgia, serif;
            font-size: 0.95rem;
        }

        /* Darm */
        .darm-container {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .darm-toggle {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            cursor: pointer;
            font-weight: bold;
            color: var(--primary-color);
        }

        #darmFelder {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr;
            gap: 1rem;
            margin-top: 0.8rem;
        }

        /* Ausgabe-Bereich */
        #ausgabeBereich {
            display: none;
        }

        #ausgabeBereich.sichtbar {
            display: block;
        }

        #jsOutput {
            background: #2a1a0e;
            color: #f0e6d3;
            font-family: 'Courier New', monospace;
            font-size: 0.85rem;
            padding: 1.5rem;
            border-radius: 6px;
            white-space: pre-wrap;
            word-break: break-all;
            max-height: 500px;
            overflow-y: auto;
            border: 2px solid var(--border-color);
        }

        .btn-primary {
            background: var(--primary-color);
            color: #FFF8DC;
            border: none;
            border-radius: 6px;
            padding: 0.8rem 2rem;
            font-size: 1.1rem;
            font-family: Georgia, serif;
            font-weight: bold;
            cursor: pointer;
            transition: background 0.2s;
        }

        .btn-primary:hover {
            background: var(--secondary-color);
        }

        .btn-secondary {
            background: rgba(139,69,19,0.12);
            color: var(--primary-color);
            border: 2px solid var(--border-color);
            border-radius: 6px;
            padding: 0.7rem 1.5rem;
            font-size: 1rem;
            font-family: Georgia, serif;
            cursor: pointer;
            transition: background 0.2s;
        }

        .btn-secondary:hover {
            background: rgba(139,69,19,0.22);
        }

        .btn-copy {
            background: var(--success-color);
            color: white;
            border: none;
            border-radius: 5px;
            padding: 0.6rem 1.2rem;
            font-family: Georgia, serif;
            font-size: 0.95rem;
            cursor: pointer;
            transition: background 0.2s;
        }

        .btn-copy:hover {
            background: #33691e;
        }

        .form-actions {
            display: flex;
            gap: 1rem;
            justify-content: flex-end;
            margin-top: 1rem;
            flex-wrap: wrap;
        }

        .info-box {
            background: rgba(85,139,47,0.12);
            border: 2px solid var(--success-color);
            border-radius: 6px;
            padding: 1rem 1.2rem;
            margin-bottom: 1rem;
            color: var(--text-color);
            font-size: 0.95rem;
        }

        .hinweis-datei {
            font-weight: bold;
            color: var(--success-color);
            font-family: 'Courier New', monospace;
        }

        @media (max-width: 640px) {
            .form-row { grid-template-columns: 1fr; }
            .form-row.triple { grid-template-columns: 1fr; }
            .schritt-einzeln { grid-template-columns: 1fr; }
            #darmFelder { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <header>
        <div class="header-content">
            <img src="logo.png" alt="Die WÃ¼rstelmacher seit 2018" class="header-logo">
            <div class="header-text">
                <h1>Die WÃ¼rstelmacher</h1>
                <p class="subtitle">est. 2018 &middot; Rezeptbuch</p>
            </div>
        </div>
        <div style="text-align:center;margin-bottom:1rem;">
            <a href="uebersicht.html" class="back-link">â† ZurÃ¼ck zur Ãœbersicht</a>
        </div>
    </header>

    <div class="form-container">

        <!-- REZEPTINFORMATIONEN -->
        <div class="form-card">
            <h2>ğŸ“‹ Rezeptinformationen</h2>
            <div class="form-row">
                <div class="form-group">
                    <label for="fTitel">Rezeptname *</label>
                    <input type="text" id="fTitel" placeholder="z.B. Hausgemachte Bratwurst">
                </div>
                <div class="form-group">
                    <label for="fKategorie">Kategorie *</label>
                    <select id="fKategorie">
                        <option value="">â€“ bitte wÃ¤hlen â€“</option>
                        <option>Bratwurst</option>
                        <option>BrÃ¼hwurst</option>
                        <option>FleischkÃ¤se</option>
                        <option>Rohwurst</option>
                        <option>Leberwurst</option>
                        <option>Blutwurst</option>
                        <option>Schinken</option>
                        <option>Aspik &amp; SÃ¼lze</option>
                        <option>Wurst im Glas</option>
                        <option>Salami</option>
                        <option>Wildwurst</option>
                        <option>Schmalz &amp; SpezialitÃ¤ten</option>
                        <option>Sonstiges</option>
                        <option>Brot</option>
                    </select>
                </div>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label for="fQuelle">Quelle / Autor</label>
                    <input type="text" id="fQuelle" placeholder="z.B. Kajo, eigenes Rezept">
                </div>
                <div class="form-group">
                    <label for="fAusgabe">Ausgabe / Ertrag</label>
                    <input type="text" id="fAusgabe" placeholder="z.B. ca. 10 WÃ¼rste, 1 Laib">
                </div>
            </div>
            <div class="form-row single">
                <div class="form-group">
                    <label for="fBeschreibung">Kurzbeschreibung</label>
                    <textarea id="fBeschreibung" placeholder="Kurze Beschreibung des Rezepts â€¦"></textarea>
                </div>
            </div>
        </div>

        <!-- FLEISCHSORTEN -->
        <div class="form-card">
            <h2>ğŸ¥© Fleischsorten (Basismenge)</h2>
            <table class="zutaten-tabelle" id="fleischTabelle">
                <thead>
                    <tr>
                        <th class="col-name">Fleischsorte</th>
                        <th class="col-menge">Menge (g)</th>
                        <th class="col-einheit">Fettgehalt</th>
                        <th class="col-del"></th>
                    </tr>
                </thead>
                <tbody id="fleischBody"></tbody>
            </table>
            <button class="btn-add-row" onclick="addFleischzeile()">+ Fleischsorte hinzufÃ¼gen</button>
        </div>

        <!-- ZUTATEN -->
        <div class="form-card">
            <h2>ğŸ§‚ Zutaten</h2>
            <p style="font-size:0.9rem;color:var(--text-muted);margin-bottom:0.8rem;">Mengen bezogen auf die angegebene Fleisch-Basismenge (oder gesamt bei Brot)</p>
            <table class="zutaten-tabelle" id="zutatenTabelle">
                <thead>
                    <tr>
                        <th class="col-name">Zutat</th>
                        <th class="col-menge">Menge</th>
                        <th class="col-einheit">Einheit</th>
                        <th class="col-del"></th>
                    </tr>
                </thead>
                <tbody id="zutatenBody"></tbody>
            </table>
            <button class="btn-add-row" onclick="addZutatzeile('zutaten')">+ Zutat hinzufÃ¼gen</button>
        </div>

        <!-- GEWÃœRZE -->
        <div class="form-card">
            <h2>ğŸŒ¿ GewÃ¼rze</h2>
            <table class="zutaten-tabelle" id="gewuerzeTabelle">
                <thead>
                    <tr>
                        <th class="col-name">GewÃ¼rz</th>
                        <th class="col-menge">Menge</th>
                        <th class="col-einheit">Einheit</th>
                        <th class="col-del"></th>
                    </tr>
                </thead>
                <tbody id="gewuerzeBody"></tbody>
            </table>
            <button class="btn-add-row" onclick="addZutatzeile('gewuerze')">+ GewÃ¼rz hinzufÃ¼gen</button>
        </div>

        <!-- DARM -->
        <div class="form-card">
            <h2>ğŸŒ­ Darm</h2>
            <label class="darm-toggle">
                <input type="checkbox" id="darmCheck" onchange="toggleDarm()">
                &nbsp;Darm wird verwendet
            </label>
            <div id="darmFelder" style="display:none;">
                <div class="form-group">
                    <label>Typ</label>
                    <input type="text" id="darmTyp" placeholder="z.B. Schweinedarm, Kunstdarm">
                </div>
                <div class="form-group">
                    <label>Kaliber (mm)</label>
                    <input type="text" id="darmKaliber" placeholder="z.B. 28/30">
                </div>
                <div class="form-group">
                    <label>Menge</label>
                    <input type="text" id="darmMenge" placeholder="z.B. nach Bedarf">
                </div>
            </div>
        </div>

        <!-- ZUBEREITUNGSSCHRITTE -->
        <div class="form-card">
            <h2>ğŸ“ Zubereitungsschritte</h2>
            <div id="schritteContainer"></div>
            <button class="btn-add-row" onclick="addSchritteGruppe()">+ Gruppe hinzufÃ¼gen</button>
        </div>

        <!-- TIPPS -->
        <div class="form-card">
            <h2>ğŸ’¡ Tipps &amp; Tricks</h2>
            <div id="tippsContainer"></div>
            <button class="btn-add-row" onclick="addTipp()">+ Tipp hinzufÃ¼gen</button>
        </div>

        <!-- AKTIONEN -->
        <div class="form-actions">
            <button class="btn-secondary" onclick="formularLeeren()">Formular leeren</button>
            <button class="btn-primary" onclick="speichereRezept()">Rezept speichern â–¶</button>
        </div>

        <!-- ERFOLGSMELDUNG -->
        <div id="erfolgMeldung" class="form-card" style="margin-top:1.5rem;display:none;border-color:var(--success-color);">
            <h2 style="color:var(--success-color);">âœ“ Rezept gespeichert!</h2>
            <p>Das Rezept wurde erfolgreich in die Datenbank eingetragen und ist sofort in der <a href="uebersicht.html" style="color:var(--primary-color);">Ãœbersicht</a> sichtbar.</p>
        </div>

    </div>

    <script src="auth.js"></script>
    <script>
        if (sessionStorage.getItem('wk_auth') !== AUTH_HASH) {
            window.location.replace('index.html');
        }
    </script>
    <script src="supabase.js"></script>
    <script>
    // â”€â”€ Einheiten â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    const EINHEITEN = ['g', 'kg', 'ml', 'l', 'EL', 'TL', 'Stk', 'Prise', 'Msp', '%'];
    const FETT_OPTIONEN = ['', 'mager', 'halbfett', 'fett', 'sehr fett', 'Speck', 'Bauchfleisch'];

    function einheitSelect(selected) {
        return `<select>${EINHEITEN.map(e => `<option${e===selected?' selected':''}>${e}</option>`).join('')}</select>`;
    }

    function fettSelect(selected) {
        return `<select>${FETT_OPTIONEN.map(e => `<option${e===selected?' selected':''}>${e}</option>`).join('')}</select>`;
    }

    // â”€â”€ Fleischsorten â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function addFleischzeile(name='', menge='', fett='') {
        const tbody = document.getElementById('fleischBody');
        const tr = document.createElement('tr');
        tr.innerHTML = `
            <td class="col-name"><input type="text" placeholder="z.B. Schweineschulter" value="${name}"></td>
            <td class="col-menge"><input type="number" min="0" step="1" placeholder="1000" value="${menge}"></td>
            <td class="col-einheit">${fettSelect(fett)}</td>
            <td class="col-del"><button class="btn-del-row" onclick="this.closest('tr').remove()">âœ•</button></td>
        `;
        tbody.appendChild(tr);
    }

    // â”€â”€ Zutaten / GewÃ¼rze â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function addZutatzeile(typ, name='', menge='', einheit='g') {
        const bodyId = typ === 'zutaten' ? 'zutatenBody' : 'gewuerzeBody';
        const tbody = document.getElementById(bodyId);
        const tr = document.createElement('tr');
        tr.innerHTML = `
            <td class="col-name"><input type="text" placeholder="Name" value="${name}"></td>
            <td class="col-menge"><input type="number" min="0" step="0.1" placeholder="0" value="${menge}"></td>
            <td class="col-einheit">${einheitSelect(einheit)}</td>
            <td class="col-del"><button class="btn-del-row" onclick="this.closest('tr').remove()">âœ•</button></td>
        `;
        tbody.appendChild(tr);
    }

    // â”€â”€ Darm â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function toggleDarm() {
        document.getElementById('darmFelder').style.display =
            document.getElementById('darmCheck').checked ? 'grid' : 'none';
    }

    // â”€â”€ Schritte â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    let gruppenZaehler = 0;

    function addSchritteGruppe(gruppenName='') {
        gruppenZaehler++;
        const gid = 'gruppe_' + gruppenZaehler;
        const container = document.getElementById('schritteContainer');
        const div = document.createElement('div');
        div.className = 'schritt-gruppe';
        div.id = gid;
        div.innerHTML = `
            <div class="schritt-gruppe-header">
                <input type="text" placeholder="Gruppenname (z.B. Vorbereitung, Braten)" value="${gruppenName}" class="gruppen-titel">
                <button class="btn-del-row" onclick="document.getElementById('${gid}').remove()" title="Gruppe lÃ¶schen">âœ•</button>
            </div>
            <div class="schritte-liste"></div>
            <button class="btn-add-row" onclick="addEinzelSchritt('${gid}')">+ Schritt hinzufÃ¼gen</button>
        `;
        container.appendChild(div);
        addEinzelSchritt(gid);
    }

    function addEinzelSchritt(gid, titel='', inhalt='') {
        const liste = document.querySelector('#' + gid + ' .schritte-liste');
        const div = document.createElement('div');
        div.className = 'schritt-einzeln';
        div.innerHTML = `
            <input type="text" placeholder="Schritttitel (z.B. Fleisch wolfen)" value="${titel}">
            <textarea placeholder="Beschreibung â€¦">${inhalt}</textarea>
            <button class="btn-del-row" style="margin-top:0.4rem;" onclick="this.parentElement.remove()" title="Schritt lÃ¶schen">âœ•</button>
        `;
        liste.appendChild(div);
    }

    // â”€â”€ Tipps â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function addTipp(text='') {
        const container = document.getElementById('tippsContainer');
        const div = document.createElement('div');
        div.className = 'tipp-zeile';
        div.innerHTML = `
            <input type="text" placeholder="Tipp â€¦" value="${text}">
            <button class="btn-del-row" onclick="this.parentElement.remove()">âœ•</button>
        `;
        container.appendChild(div);
    }

    // â”€â”€ InitialbefÃ¼llung â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    addFleischzeile();
    addZutatzeile('zutaten');
    addZutatzeile('gewuerze');
    addSchritteGruppe('Zubereitung');
    addTipp();

    // â”€â”€ Formular leeren â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function formularLeeren() {
        if (!confirm('Formular wirklich leeren?')) return;
        ['fTitel','fKategorie','fQuelle','fAusgabe','fBeschreibung',
         'darmTyp','darmKaliber','darmMenge'].forEach(id => {
            const el = document.getElementById(id);
            if (el) el.value = '';
        });
        document.getElementById('darmCheck').checked = false;
        document.getElementById('darmFelder').style.display = 'none';
        document.getElementById('fleischBody').innerHTML = '';
        document.getElementById('zutatenBody').innerHTML = '';
        document.getElementById('gewuerzeBody').innerHTML = '';
        document.getElementById('schritteContainer').innerHTML = '';
        document.getElementById('tippsContainer').innerHTML = '';
        document.getElementById('erfolgMeldung').style.display = 'none';
        gruppenZaehler = 0;
        addFleischzeile();
        addZutatzeile('zutaten');
        addZutatzeile('gewuerze');
        addSchritteGruppe('Zubereitung');
        addTipp();
    }

    // â”€â”€ Zeilen auslesen â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function leseTabellenzeilen(bodyId) {
        const rows = document.querySelectorAll('#' + bodyId + ' tr');
        const result = [];
        rows.forEach(tr => {
            const inputs = tr.querySelectorAll('input, select');
            if (inputs.length < 2) return;
            const name = inputs[0].value.trim();
            if (!name) return;
            const menge = parseFloat(inputs[1].value) || 0;
            const einheit = inputs[2] ? inputs[2].value : 'g';
            result.push({ name, menge, einheit });
        });
        return result;
    }

    function leseFleisch() {
        const rows = document.querySelectorAll('#fleischBody tr');
        const result = [];
        rows.forEach(tr => {
            const inputs = tr.querySelectorAll('input, select');
            const name = inputs[0]?.value.trim();
            if (!name) return;
            const menge = parseInt(inputs[1]?.value) || 0;
            const fett = inputs[2]?.value || '';
            result.push({ name, menge, fettgehalt: fett });
        });
        return result;
    }

    function leseSchritte() {
        const gruppen = document.querySelectorAll('.schritt-gruppe');
        const result = [];
        gruppen.forEach(gDiv => {
            const gruppenTitel = gDiv.querySelector('.gruppen-titel')?.value.trim() || 'Zubereitung';
            const schrittDivs = gDiv.querySelectorAll('.schritt-einzeln');
            const schritte = [];
            schrittDivs.forEach(sd => {
                const inputs = sd.querySelectorAll('input, textarea');
                const titel = inputs[0]?.value.trim();
                const inhalt = inputs[1]?.value.trim();
                if (titel || inhalt) {
                    schritte.push({ titel: titel || '', inhalt: inhalt || '' });
                }
            });
            if (schritte.length > 0) {
                result.push({ gruppe: gruppenTitel, schritte });
            }
        });
        return result;
    }

    function leseTipps() {
        const inputs = document.querySelectorAll('#tippsContainer .tipp-zeile input');
        return Array.from(inputs).map(i => i.value.trim()).filter(Boolean);
    }

    // â”€â”€ Rezept sammeln â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function sammleRezept(id) {
        const fleisch = leseFleisch();
        const basisGesamt = fleisch.reduce((s, f) => s + (f.menge || 0), 0);
        const darmCheck = document.getElementById('darmCheck').checked;
        let darm = null;
        if (darmCheck) {
            darm = {
                typ: document.getElementById('darmTyp').value.trim() || '',
                kaliber: document.getElementById('darmKaliber').value.trim() || '',
                menge: document.getElementById('darmMenge').value.trim() || ''
            };
        }
        return {
            id,
            titel:          document.getElementById('fTitel').value.trim(),
            kategorie:      document.getElementById('fKategorie').value,
            beschreibung:   document.getElementById('fBeschreibung').value.trim(),
            quelle:         document.getElementById('fQuelle').value.trim(),
            basis_gesamt:   basisGesamt,
            fleischsorten:  fleisch,
            zutaten:        leseTabellenzeilen('zutatenBody'),
            gewuerze:       leseTabellenzeilen('gewuerzeBody'),
            darm,
            ausgabe:        document.getElementById('fAusgabe').value.trim(),
            schritte:       leseSchritte(),
            tipps:          leseTipps()
        };
    }

    // â”€â”€ Speichern in Supabase â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    async function speichereRezept() {
        const titel = document.getElementById('fTitel').value.trim();
        const kategorie = document.getElementById('fKategorie').value;
        if (!titel) { alert('Bitte Rezeptname eingeben.'); return; }
        if (!kategorie) { alert('Bitte Kategorie wÃ¤hlen.'); return; }

        const btn = document.querySelector('.btn-primary');
        btn.disabled = true;
        btn.textContent = 'â³ Wird gespeichert â€¦';

        try {
            const neueId = await sb.naechsteId('rezepte');
            const row = sammleRezept(neueId);
            await sb.insert('rezepte', row);

            // Erfolgsmeldung
            document.getElementById('erfolgMeldung').style.display = 'block';
            document.getElementById('erfolgMeldung').scrollIntoView({ behavior: 'smooth' });
            formularLeeren();
        } catch (err) {
            alert('Fehler beim Speichern: ' + err.message);
        } finally {
            btn.disabled = false;
            btn.textContent = 'Rezept speichern â–¶';
        }
    }
    </script>
</body>
</html>
