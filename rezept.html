<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rezept – Die Würstelmacher Rezeptbuch</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <header>
        <div class="header-content">
            <img src="logo.png" alt="Die Würstelmacher seit 2018" class="header-logo">
            <div class="header-text">
                <h1>Die Würstelmacher</h1>
                <p class="subtitle">est. 2018 &middot; Rezeptbuch</p>
            </div>
        </div>
        <a href="uebersicht.html" class="back-link">← Zurück zur Übersicht</a>
    </header>

    <main id="rezeptDetail">
        <!-- Rezeptdetails werden hier dynamisch eingefügt -->
    </main>

    <script src="auth.js"></script>
    <script>
        // Auth-Check
        if (sessionStorage.getItem('wk_auth') !== AUTH_HASH) {
            window.location.replace('index.html');
        }
    </script>

    <script src="supabase.js"></script>
    <script>
        // Ladeindikator
        document.getElementById('rezeptDetail').innerHTML =
            '<p style="text-align:center;color:#6D4C41;padding:3rem;font-size:1.2rem;">⏳ Rezept wird geladen …</p>';

        // Rezept-ID aus URL
        const urlParams = new URLSearchParams(window.location.search);
        const rezeptId = parseInt(urlParams.get('id')) || 1;

        // Supabase: Rezept laden
        sb.getById('rezepte', rezeptId)
          .then(row => {
            if (!row) {
                document.getElementById('rezeptDetail').innerHTML =
                    '<p style="text-align:center;color:#c0392b;padding:3rem;">Rezept nicht gefunden.</p>';
                return;
            }

            // Globale Variable setzen
            window.rezepteGeladen = [rowZuRezept(row)];

            // Rezept.js laden
            const s = document.createElement('script');
            s.src = 'rezept.js';
            // Init-Funktion aufrufen, sobald Script geladen ist
            s.onload = () => {
                if (typeof initRezept === "function") {
                    initRezept();
                }
            };
            document.body.appendChild(s);
        })
        .catch(err => {
            document.getElementById('rezeptDetail').innerHTML =
                `<p style="text-align:center;color:#c0392b;padding:3rem;">⚠️ Fehler: ${err.message}</p>`;
        });
    </script>
</body>
</html>
